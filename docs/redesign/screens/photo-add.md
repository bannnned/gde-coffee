# Wave 2 Screen Spec: Add Photo (добавление фото)

Источник:
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/components/CafePhotoSubmissionModal.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/components/CafePhotoAdminModal.tsx`

## 1. Цель зоны

Сделать загрузку фото быстрой, понятной и надежной:
1. пользователь добавляет фото места/меню без лишних шагов;
2. админ управляет фото (порядок, обложка, удаление) без потери данных;
3. система корректно обрабатывает ошибки и фоновые статусы.

## 2. Два режима

1. **User submission mode** (`CafePhotoSubmissionModal`)
- отправка фото на модерацию;
- выбор типа: `фото места` / `фото меню`;
- drag&drop и file picker;
- очередь загрузки с ограничением concurrency;
- post-submit feedback.

2. **Admin manage mode** (`CafePhotoAdminModal`)
- прямая загрузка в карточку кофейни;
- сортировка/перестановка;
- установка cover (для фото места);
- удаление фото;
- сохранение порядка.

## 3. Пользовательские задачи

1. Быстро добавить первое фото, если фото нет.
2. Добавить несколько фото за один проход.
3. Понять, что фото отправлено/загружено успешно.
4. Для админа: поддерживать фотоактуальность карточки.

## 4. API-зависимости

User submission:
1. `POST /api/submissions/photos/presign`
2. upload в presigned URL
3. `POST /api/submissions/cafes/:id/photos`
4. `POST /api/submissions/cafes/:id/menu-photos`

Admin manage:
1. `GET /api/cafes/:id/photos?kind=...`
2. `POST /api/cafes/:id/photos/presign`
3. upload в presigned URL
4. `POST /api/cafes/:id/photos/confirm`
5. `PATCH /api/cafes/:id/photos/order`
6. `PATCH /api/cafes/:id/photos/:photoId/cover`
7. `DELETE /api/cafes/:id/photos/:photoId`

## 5. Ключевые UX-контракты

1. Пользователь всегда видит текущий статус операции:
- подготовка,
- upload,
- сохранение,
- ошибка/успех.
2. Ошибка не обнуляет весь процесс без явной причины.
3. После успешной операции карточка кофейни обновляет фото-данные.
4. Кнопки фиксированы и доступны в ожидаемой зоне экрана (с safe-area).
5. Поведение одинаково предсказуемо для `cafe` и `menu` типов.

## 6. Состояния и edge cases

1. Пустое состояние (нет фото).
2. Upload in progress (локальные скелетоны/индикаторы).
3. Частичная ошибка загрузки.
4. Ошибка подтверждения/сохранения порядка.
5. Удаление одного фото не должно скрывать остальные.
6. Обновление данных после закрытия/возврата в деталку.
7. Большие файлы, неподдерживаемый тип, сетевые ошибки.

## 7. UX-цели редизайна

1. Сократить когнитивную нагрузку на экранах загрузки.
2. Снизить вероятность ошибочного действия при удалении/сортировке.
3. Сделать sticky action зону визуально чистой и стабильной.
4. Повысить доверие пользователя к процессу (четкая обратная связь).

## 8. Что НЕ входит

1. Полная переработка модерационного workflow backend.
2. Смена storage-архитектуры или image-пайплайна.
3. Редизайн не связанных админских экранов.

## 9. Definition of Done (для Add Photo)

1. User submission flow стабилен для `cafe/menu`:
- выбрать фото,
- отправить,
- получить понятный результат.
2. Admin mode стабилен:
- загрузка,
- reorder,
- cover,
- delete,
- обновление списка.
3. После операций отображается актуальное состояние фото без “старых” данных.
4. Все состояния `loading/empty/error` отрисованы и понятны.
5. iOS/PWA safe-area и скролл не ломают доступность primary action.
6. Экран проходит rubric:
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01a-practical-ui-rubric.md` (>= 17/20).

## 10. Smoke-сценарии приемки

1. Пользователь добавляет 1-3 фото места, видит успех и обновление карточки.
2. Пользователь добавляет фото меню, видит их в соответствующей зоне.
3. Админ меняет порядок фото и сохраняет.
4. Админ удаляет фото, остальные фото остаются и корректно отображаются.
5. Сеть/серверная ошибка дает понятное сообщение и возможность повторить.
