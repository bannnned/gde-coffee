# Wave 1 Screen Spec: Discovery (`/`)

Источник:
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/pages/DiscoveryScreen.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/hooks/useDiscoveryPageController.ts`

## 1. Цель экрана

Главный продуктовый экран выбора кофейни:
1. быстро найти подходящую кофейню рядом;
2. перейти к деталям;
3. начать маршрут/визит.

## 2. Пользовательские задачи

1. Определить геопозицию или выбрать город/точку.
2. Просмотреть релевантные кофейни на карте и в списке.
3. Выбрать конкретную кофейню и перейти в подробности.
4. Переключить режим “избранные”.
5. Настроить радиус и теги в настройках главного экрана.

## 3. Структура UI (текущая)

1. `Map` как основной canvas.
2. Верхняя панель (`FiltersBar`):
   - профиль/вход,
   - избранные,
   - настройки,
   - верхние теги.
3. `FloatingControls` (геолокация).
4. `BottomSheet`:
   - header state: first choice / manual pick / selected cafe / empty state,
   - body: список кофеен (`CafeList`).
5. Всплывающие состояния:
   - `SettingsDrawer`,
   - `CafeDetailsScreen`,
   - `CafePhoto*` модалки,
   - `CafeProposalModal`,
   - `ManualPickOverlay`.

## 4. Состояния (обязательные)

1. `first choice` — начальный выбор гео/города/ручной точки.
2. `loading` — загрузка списка кофеен.
3. `ready` — карта + выбранная карточка + список.
4. `empty` — ничего не найдено.
5. `error` — ошибка загрузки.
6. `manual pick` — режим ручного выбора центра карты.

Каждое состояние должно быть визуально предсказуемым и без “дергания” layout.

## 5. Данные и зависимости

Основные API:
1. `GET /api/cafes` — список кофеен.
2. `GET /api/tags/descriptive/discovery` — верхние теги.
3. `GET/PUT /api/tags/descriptive/preferences` — любимые теги пользователя.
4. `GET /api/tags/descriptive/options` — поиск/подбор тегов.
5. `POST /api/metrics/events` — продуктовые события.

Ключевые UX-контракты:
1. Список и карта всегда синхронизированы по выбранной кофейне.
2. Изменения фильтров/радиуса отражаются без потери контекста.
3. Защищенные действия вызывают auth flow, не ломая экран.

## 6. Метрики и события (на экране)

Из экрана и связанных контроллеров отправляются:
1. `cafe_card_open`
2. `route_click`
3. события через деталку/отзывы (`review_read`, `checkin_start`, `review_submit`).

В редизайне нельзя удалять эти события; допустимо только менять момент/место триггера осмысленно и явно.

## 7. Проблемы, которые редизайн должен решить (Wave 1)

1. Снизить визуальный шум и убрать лишнюю плотность “служебных” блоков.
2. Сделать первичное действие очевидным (выбор кофейни/переход в деталку).
3. Выравнять визуальную иерархию между картой, карточкой и списком.
4. Сохранить быстрый доступ к настройкам, но не перегружать верхнюю зону.
5. Стабилизировать поведение на iOS (safe-area, overlay, жесты).

## 8. Что входит в Wave 1 для Discovery

1. Полный визуальный редизайн главного экрана.
2. UX-переосмысление верхней панели и `BottomSheet` структуры.
3. Редизайн `SettingsDrawer` (настройки главного экрана).
4. Унификация состояний `loading/empty/error`.

Детализация настроек вынесена в:
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/screens/discovery-settings.md`

## 9. Что не входит (для этого файла)

1. Деталка кофейни и вкладки (это Wave 2).
2. Профиль и настройки профиля (Wave 3).
3. Админские экраны.

## 10. Definition of Done (для Discovery, Wave 1)

1. Все состояния из раздела 4 реализованы и визуально согласованы.
2. Переходы из `/` в `/profile` и `/settings` не сбрасывают состояние `/`.
3. Сценарий `гео -> список -> выбор кофейни -> деталка -> назад` стабилен.
4. Сценарий `настройки -> изменение радиуса/тегов -> обновление выдачи` стабилен.
5. Нет критических регрессий по метрикам и auth-потокам.
6. Экран проходит правила из:
   - `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01-practical-ui-rules.md`
   - `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/03-definition-of-done.md`
