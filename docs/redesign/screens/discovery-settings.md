# Wave 1 Screen Spec: Discovery Settings (Drawer на `/`)

Источник:
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/ui/settings/SettingsDrawer.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/hooks/useDiscoveryPageController.ts`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/model/location/useDiscoveryLocation.ts`

## 1. Цель зоны

`SettingsDrawer` — контекстные настройки главного экрана.  
Пользователь должен быстро управлять выдачей кофеен, не покидая `/`.

## 2. Роль в Wave 1

Входит в Wave 1 полностью:
1. UX-переосмысление структуры настроек.
2. Визуальная миграция в новый стиль (shadcn-like).
3. Упрощение иерархии и текстов.
4. Стабильная работа на мобильных сценариях.

## 3. Состав функциональных блоков (текущее ядро)

1. **Место**
- выбор города из `Select`,
- ручной выбор точки на карте,
- текущий label местоположения.

2. **Контент**
- действие “Предложить кофейню”.

3. **Теги на главной**
- популярные теги (до 5),
- выбор/снятие тегов,
- расширенный пикер существующих тегов по поиску,
- сохранение теговых предпочтений пользователя.

4. **Радиус**
- пресеты: `1 км`, `2.5 км`, `5 км`, `Весь (0)`.

## 4. Пользовательские задачи

1. Сменить область поиска (город/точка/гео-контекст).
2. Ограничить или расширить радиус выдачи.
3. Настроить верхние теги под личные предпочтения.
4. Инициировать предложение новой кофейни.

## 5. Ключевые UX-контракты

1. Все действия в Drawer применяются в рамках текущего контекста `/`, без полной перезагрузки сценария.
2. Drawer не ломает текущее состояние выбранной кофейни без причины.
3. Неавторизованный пользователь:
- видит блок тегов,
- но не может сохранять персональные теги (понятный gating).
4. Изменение радиуса и локации должно предсказуемо менять выдачу.

## 6. Состояния и edge cases

1. **Top tags loading** — видны временные индикаторы.
2. **Top tags saving** — кнопка сохранения в loading/disabled.
3. **Top tags error** — ошибка отображается рядом с зоной тегов.
4. **No tag options** — понятный empty-state в поиске тегов.
5. **Неавторизован** — disabled/подсказка вместо “тихого” отказа.
6. **Гео недоступно** — не должно блокировать выбор города и ручную точку.

## 7. Данные и зависимости

API:
1. `GET /api/tags/descriptive/discovery`
2. `GET /api/tags/descriptive/options`
3. `GET /api/tags/descriptive/preferences` (auth)
4. `PUT /api/tags/descriptive/preferences` (auth)

Локальное состояние:
1. `locationChoice` хранится в `localStorage` (`LOCATION_STORAGE_KEY`).
2. Радиус влияет на `effectiveRadiusM`.

## 8. UX-цели редизайна для этого экрана

1. Сократить когнитивную нагрузку:
- сначала “где искать”,
- затем “как фильтровать”,
- затем “доп.действия”.

2. Убрать визуальные дубли:
- меньше вспомогательных текстов,
- компактнее вертикальный ритм,
- одинаковый паттерн интерактивных элементов.

3. Сделать быстрое сканирование:
- ясные заголовки блоков,
- заметный primary-action,
- понятные disabled/loading состояния.

4. Снизить friction в тегах:
- понятный flow добавления существующего тега,
- явная обратная связь “сохранено/ошибка”.

## 9. Что НЕ входит

1. Редизайн деталей кофейни и вкладок (Wave 2).
2. Логика профиля/аккаунта (Wave 3).
3. Админский функционал.

## 10. Definition of Done (для Discovery Settings)

1. Пользователь за <= 2 шага понимает, где сменить:
- место,
- радиус,
- теги.
2. Все состояния `loading/disabled/error` видимы и однозначны.
3. Неавторизованный gating реализован без “мертвых” кнопок.
4. Изменение настроек отражается на выдаче без визуальных артефактов.
5. iOS Safari/PWA:
- header/контент Drawer не уезжают в safe-area,
- скролл и touch стабильны.
6. Экран проходит:
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01-practical-ui-rules.md`
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01a-practical-ui-rubric.md` (>= 17/20)

## 11. Smoke-сценарии для приемки

1. Гость открывает Drawer, меняет радиус, видит обновление выдачи.
2. Гость не может сохранить любимые теги, но понимает почему.
3. Авторизованный пользователь:
- добавляет тег из поиска,
- удаляет тег,
- сохраняет,
- видит успешное применение.
4. Переключение города + ручная точка работает без зависаний.
5. Закрытие Drawer возвращает в прежний контекст `Discovery`.
