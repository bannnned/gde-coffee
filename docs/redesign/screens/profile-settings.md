# Wave 3 Screen Spec: Profile Settings (`/settings`)

Источник:
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/pages/SettingsScreen.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/api/auth.ts`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/api/feedback.ts`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/api/reviews.ts`

## 1. Цель экрана

`Settings` — центр управления аккаунтом и системными настройками:
1. Безопасность (почта/пароль/верификация).
2. Персональные настройки (тема).
3. Обратная связь.
4. Для модераторов/админов: операционный доступ к служебным разделам.

## 2. Роль в Wave 3

Входит в Wave 3 полностью:
1. Пересборка длинной “лестницы” секций в структурированный, компактный flow.
2. Четкая иерархия обычных пользовательских действий и служебных (admin/moderator).
3. Единый визуальный паттерн форм, статусов и action-групп.

## 3. Состав функциональных блоков (текущее ядро)

1. **Header**
- назад,
- заголовок состояния аккаунта.

2. **Модерация (role-gated)**
- ссылки на admin/moderation/drinks/metrics/feedback/cafes,
- статус версионирования отзывов,
- health reviews/AI,
- DLQ replay/resolve инструменты.

3. **Тема**
- переключение светлая/темная.

4. **Данные аккаунта**
- email + статус верификации,
- ID аккаунта.

5. **Подключение соцсетей**
- статусы подключения GitHub/Яндекс/Telegram,
- CTA подключения недостающих провайдеров.

6. **Почта**
- статус верификации,
- отправка письма подтверждения.

7. **Смена данных**
- форма смены имени,
- форма смены email (новый email + текущий пароль),
- форма reset-письма для смены пароля.

8. **Отзыв о приложении**
- кнопка раскрытия формы,
- текст + контакт,
- отправка/ошибки/успех.

## 4. Пользовательские задачи

1. Проверить и подтвердить email.
2. Обновить имя профиля.
3. Запросить смену email.
4. Запросить письмо для смены пароля.
5. Сменить тему приложения.
6. Подключить соцсети.
7. Отправить отзыв о приложении.
8. Для модератора/админа: открыть служебные панели и диагностику.

## 5. Ключевые UX-контракты

1. Доступность действий строго соответствует роли и auth-статусу.
2. Критичные формы (email/password) дают мгновенную и понятную валидацию.
3. Сообщения успеха/ошибки не ломают layout и не перекрывают соседние действия.
4. Back-навигация сохраняет overlay-контекст, если экран открыт поверх Discovery.
5. Служебные admin-блоки не мешают обычному пользовательскому сценарию.
6. Смена имени/email/пароля собрана в единый block-flow (`Смена данных`) без прыжков между секциями.

## 6. Состояния и edge cases

1. `status=loading`: корректный loading заголовка/блока.
2. Неавторизован: недоступные действия отключены, причина понятна.
3. Ошибки API в каждом блоке показываются локально, без общего “падения” страницы.
4. Длинные ответы/диагностика (health/DLQ) не вызывают визуальную перегрузку.
5. Формы на мобильных (iOS/Safari) не должны ломать скролл и safe-area.

## 7. Данные и зависимости

Пользовательские API:
1. `POST /api/auth/email/verify/request`
2. `PATCH /api/account/profile/name`
3. `POST /api/account/email/change/request`
4. `POST /api/auth/password/reset/request`
5. `POST /api/account/feedback`
6. `GET /api/auth/identities`

Операционные API (moderator/admin):
1. `GET /api/admin/reviews/versioning`
2. `GET /api/admin/reviews/health`
3. `GET /api/admin/reviews/dlq`
4. `POST /api/admin/reviews/dlq/:id/replay`
5. `POST /api/admin/reviews/dlq/replay-open`
6. `POST /api/admin/reviews/dlq/resolve-open`

Локальные зависимости:
1. Цветовая схема Mantine (`setColorScheme`).
2. `backgroundLocation` overlay-навигация.

## 8. UX-цели редизайна для этого экрана

1. Разделить “базовые настройки” и “служебные панели” на уровне структуры и визуального веса.
2. Сократить визуальную длину экрана:
- более компактные секции,
- ясные заголовки,
- предсказуемые CTA.
3. Привести формы к единому паттерну: label, helper, error, success.
4. Сделать высокую читаемость на мобильных без прозрачных/некликабельных контролов.

## 9. Что НЕ входит

1. Полная переделка админских отдельных страниц (`/admin/*`) в рамках этой волны.
2. Изменение backend-бизнес-логики email/password flow.
3. Переделка системы ролей и прав доступа.

## 10. Definition of Done (для Profile Settings)

1. Все пользовательские настройки доступны и понятны без скрытых состояний.
2. Формы email/password проходят happy-path + error-path без визуальных артефактов.
3. Feedback flow стабилен и не мешает остальным секциям.
4. Role-gated секции отображаются корректно для guest/user/mod/admin.
5. iOS Safari/PWA: скролл, safe-area и работа клавиатуры стабильны.
6. Экран проходит:
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01-practical-ui-rules.md`
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01a-practical-ui-rubric.md` (>= 17/20)

## 11. Smoke-сценарии для приемки

1. Авторизованный пользователь отправляет запрос на подтверждение email.
2. Авторизованный пользователь меняет имя профиля в блоке `Смена данных`.
3. Авторизованный пользователь отправляет запрос на смену email.
4. Авторизованный пользователь отправляет reset-password письмо.
5. Авторизованный пользователь подключает соцсеть.
6. Авторизованный пользователь отправляет отзыв о приложении.
7. Админ открывает блок модерации и получает данные версионирования/health/DLQ.
8. Возврат назад из `/settings`, открытого поверх Discovery, не сбрасывает основной контекст.
