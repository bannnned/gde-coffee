# Wave 2 Screen Spec: Cafe Details (карточка кофейни, 3 вкладки)

Источник:
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/ui/details/CafeDetailsScreen.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/ui/details/sections/AboutSection.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/ui/details/sections/MenuSection.tsx`
- `/Users/a1/Desktop/Prog/gde-coffee/frontend/src/features/discovery/ui/details/ReviewsSection.tsx`

## 1. Цель экрана

Деталка должна помогать принять решение “идти / не идти” за минимальное время:
1. быстро показать фото и атмосферу;
2. дать понятные сигналы качества (рейтинг, отзывы, теги);
3. дать следующий шаг (маршрут, отзыв, фото).

## 2. Состав экрана (Wave 2 scope)

1. Header модалки/экрана.
2. Вкладки:
- `О месте` (About),
- `Меню` (Menu),
- `Отзывы` (Reviews).
3. Лайтбокс фото.
4. Действия:
- избранное,
- маршрут,
- добавить/управлять фото,
- оставить/редактировать отзыв.

## 3. Вкладка 1: О месте

Содержимое:
1. Главная фото-область (или CTA “добавить первое фото”).
2. Горизонтальная лента фото (если >1).
3. Блок рейтинга/диагностики (в user-safe формате).
4. Название/адрес/дистанция.
5. Маршруты (2ГИС/Яндекс).
6. Описание (просмотр/редактирование по роли).

UX-требования:
1. Главная зона должна отвечать на вопрос “что это за место” за 2-3 секунды.
2. Текст и мета не должны конфликтовать с визуальным блоком фото.
3. Редактирование описания не должно ломать ритм секции.

## 4. Вкладка 2: Меню

Содержимое:
1. Главная фото-область меню (или CTA “добавить первое фото”).
2. Дата добавления главного фото меню.
3. Список конкретных тегов/позиций (если есть).
4. Лента фото меню (если >1).
5. CTA добавления фото меню.

UX-требования:
1. Пользователь быстро понимает, есть ли меню-контент.
2. Пустое состояние дает понятный следующий шаг.
3. Секция тегов компактная и сканируемая.

## 5. Вкладка 3: Отзывы

Содержимое:
1. Лента отзывов с сортировкой и фильтрацией.
2. Sticky CTA создания/редактирования собственного отзыва.
3. Композер отзыва (раскрывающийся/сворачиваемый).
4. Полезность отзыва, модерационные действия по роли.

UX-требования:
1. Чтение отзывов — основной фокус, композер не перегружает экран.
2. Добавление/редактирование отзыва ощущается как единый flow.
3. Состояния загрузки и пагинации не “дергают” UI.

## 6. Данные и API-зависимости

Основные:
1. `GET /api/cafes/:id/photos?kind=cafe|menu`
2. `GET /api/cafes/:id/rating`
3. `GET /api/cafes/:id/reviews`
4. `POST /api/reviews`
5. `PATCH /api/reviews/:id`
6. `POST /api/reviews/:id/helpful`
7. `POST /api/cafes/:id/check-in/start`
8. `POST /api/reviews/:id/visit/verify`

Дополнительно (по ролям):
1. `PATCH /api/cafes/:id/description`
2. `GET /api/admin/cafes/:id/rating-diagnostics`
3. `POST /api/admin/cafes/:id/rating-ai-summarize`

## 7. Ключевые UX-контракты

1. Открытие/закрытие деталки не ломает состояние `Discovery`.
2. Переключение вкладок не сбрасывает важный пользовательский контекст.
3. После операций с отзывом/фото данные деталки обновляются предсказуемо.
4. Неавторизованные действия корректно переводят в auth flow поверх контекста.
5. Фото открываются в централизованном viewer с листанием.

## 8. Проблемы, которые Wave 2 должен закрыть

1. Убрать перегруз в верхней части деталки.
2. Упростить структуру вкладок для быстрого сканирования.
3. Сделать единый визуальный паттерн для CTA в трех вкладках.
4. Снизить конфликт между скроллом контента и интерактивными элементами.
5. Повысить качество пустых/ошибочных состояний.

## 9. Что НЕ входит

1. Переработка главного экрана и settings drawer (Wave 1).
2. Профиль и настройки профиля (Wave 3).
3. Глубокая смена доменной логики рейтинга/метрик.

## 10. Definition of Done (для Cafe Details)

1. Все три вкладки визуально и поведенчески согласованы в единую систему.
2. Переход `Discovery -> Details -> Back` стабилен без потери состояния.
3. Для каждой вкладки закрыты состояния `loading/empty/error`.
4. Критичные действия работают:
- маршрут,
- избранное,
- полезность,
- создание/редактирование отзыва,
- открытие фото viewer.
5. iOS/PWA: safe-area, скролл и жесты работают без конфликтов.
6. Экран проходит rubric:
- `/Users/a1/Desktop/Prog/gde-coffee/docs/redesign/01a-practical-ui-rubric.md` (>= 17/20).
