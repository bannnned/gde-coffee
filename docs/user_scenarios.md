# Пользовательские сценарии (v0)

Документ фиксирует базовые пользовательские сценарии для текущей версии приложения.  
Фокус: самые очевидные пользовательские пути, которые должны работать стабильно.

## Статус проверки
- Дата проверки: 2026-02-21.
- Легенда: `OK` — подтверждено по коду и/или тестам, `PARTIAL` — реализовано частично или зависит от внешних условий.

## 1. Гость открывает приложение и видит подборку кофеен
- Статус: `PARTIAL`.
- Комментарий: дефолтный город СПб подтвержден, но наличие "нескольких вариантов" зависит от данных API.
- Роль: гость.
- Цель: быстро увидеть релевантные кофейни рядом.
- Шаги:
1. Пользователь открывает приложение.
2. Выбирает геолокацию или использует город по умолчанию (СПб).
3. Видит карту, выбранную карточку кофейни и список ниже.
- Ожидаемый результат:
1. Экран загружается без падений.
2. Карта и список синхронизированы.
3. Есть выбранная кофейня и минимум несколько вариантов в списке.

## 2. Пользователь выбирает кофейню из списка
- Статус: `OK`.
- Комментарий: выбор обновляет верхнюю карточку и фокус карты.
- Роль: гость/авторизованный.
- Цель: переключаться между кофейнями и смотреть ключевую инфу.
- Шаги:
1. Пользователь нажимает на карточку кофейни в списке.
2. Выбранная карточка наверху обновляется (фото, название, адрес, рейтинг, отзывы).
3. Карта фокусируется на выбранной точке.
- Ожидаемый результат:
1. Выбор происходит быстро и без перезагрузки экрана.
2. Состояние списка, карточки и карты не расходится.

## 3. Пользователь строит маршрут
- Статус: `PARTIAL`.
- Комментарий: ссылки 2ГИС/Яндекс формируются корректно, но в city-only режиме кнопки маршрута скрываются.
- Роль: гость/авторизованный.
- Цель: перейти в навигацию в 1-2 тапа.
- Шаги:
1. Пользователь открывает выбранную карточку кофейни.
2. Нажимает кнопку `2ГИС` или `Яндекс`.
3. Открывается соответствующее приложение/ссылка с маршрутом.
- Ожидаемый результат:
1. Передаются корректные координаты кофейни.
2. Переход работает на мобильных устройствах.

## 4. Пользователь открывает деталку кофейни
- Статус: `OK`.
- Комментарий: клик по выбранной карточке открывает деталку; свайп фото поддержан.
- Роль: гость/авторизованный.
- Цель: посмотреть фото, рейтинг, отзывы и меню.
- Шаги:
1. Пользователь нажимает на выбранную карточку.
2. Открывается экран деталей.
3. Пользователь листает фото свайпом и скроллит разделы.
- Ожидаемый результат:
1. Деталка открывается поверх главного экрана.
2. Фото листаются, индикаторы обновляются корректно.
3. Возврат на главный экран не сбрасывает карту и фильтры.

## 5. Пользователь отмечает отзыв как полезный
- Статус: `OK`.
- Комментарий: для неавторизованного пользователя открывается модалка входа поверх интерфейса.
- Роль: авторизованный (или гость с авторизацией через модалку).
- Цель: дать сигнал полезности отзыва.
- Шаги:
1. Пользователь нажимает `Полезно` у отзыва.
2. Если не авторизован, открывается модалка входа поверх интерфейса.
3. После входа голос отправляется.
- Ожидаемый результат:
1. Кнопка имеет состояние загрузки во время запроса.
2. Счетчик полезности обновляется после успешного ответа.

## 6. Пользователь создает отзыв
- Статус: `OK`.
- Комментарий: 3 поля в форме, валидация "хотя бы одно заполнено", в публикации отображаются только заполненные блоки.
- Роль: авторизованный.
- Цель: оставить структурированный отзыв о визите.
- Шаги:
1. Пользователь открывает форму добавления отзыва.
2. Заполняет одно или несколько полей: `Понравилось`, `Не понравилось`, `Короткий вывод`.
3. При необходимости добавляет теги/позиции и отправляет.
- Ожидаемый результат:
1. Валидация: заполнено хотя бы одно текстовое поле.
2. В опубликованном отзыве показываются только заполненные блоки.

## 7. Пользователь добавляет фото (профиль/кофейня)
- Статус: `OK`.
- Комментарий: реализован upload/confirm flow для профиля и фото кофейни.
- Роль: авторизованный.
- Цель: загрузить актуальные фото.
- Шаги:
1. В профиле нажимает кнопку добавления фото аватара или в деталке добавляет фото кофейни.
2. Выбирает изображение.
3. Дожидается загрузки и подтверждения.
- Ожидаемый результат:
1. Виден прогресс загрузки.
2. После успеха фото появляется в интерфейсе.

## 8. Пользователь работает с профилем
- Статус: `PARTIAL`.
- Комментарий: функционально реализовано (имя/аватар/feedback), но критерий "быстро и стабильно" не закрыт отдельными perf-тестами.
- Роль: авторизованный.
- Цель: управлять личными данными и обратной связью.
- Шаги:
1. Открывает экран профиля.
2. Меняет имя/аватар.
3. При необходимости отправляет отзыв о приложении через форму.
- Ожидаемый результат:
1. Экран профиля открывается быстро и стабильно.
2. Данные сохраняются и отображаются после возврата.

## 9. Пользователь применяет фильтры и возвращается назад
- Статус: `OK`.
- Комментарий: экран профиля открывается как overlay c `backgroundLocation`, поэтому главный экран (карта/фильтры) не размонтируется.
- Роль: гость/авторизованный.
- Цель: уточнить выдачу и не потерять состояние.
- Шаги:
1. Пользователь применяет фильтры на главном экране.
2. Переходит в другие экраны (например, профиль) и возвращается.
- Ожидаемый результат:
1. Карта не пересоздается.
2. Выбранные фильтры сохраняются.
3. Позиция нижнего блока и выбранная кофейня не сбрасываются.

## Что добавить в следующей итерации
- Сценарии админа: массовый импорт кофеен из JSON, модерация фото и отзывов.
- Сценарии ошибок: нет сети, отказ геолокации, пустая выдача, 401/500.
- Сценарии метрик: события для North Star и воронки `карточка -> маршрут`.
